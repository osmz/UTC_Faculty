<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Informaci√≥n de Docentes - Universidad Aut√≥noma de Manizales</title>
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <div class="container">
    <h1>üìã Informaci√≥n de Docentes</h1>
    <p class="subtitle">Universidad Aut√≥noma de Manizales</p>
    
    <div class="search-group">
      <input 
        type="text" 
        id="busqueda" 
        placeholder="Buscar por nombre, c√©dula o departamento..." 
        autocomplete="off"
      >
      <button id="btnBuscar">Buscar</button>
      <button id="btnLimpiar" style="background: #999; margin-left: 5px;">Limpiar</button>
    </div>

    <div class="cargando" id="cargando">‚è≥ Cargando datos...</div>
    <div class="error" id="error"></div>

    <!-- SECCI√ìN DE RESULTADOS M√öLTIPLES -->
    <div id="resultadosMultiplesContainer" style="display: none;">
      <h3 style="color: #0069A3; margin-bottom: 15px;">Se encontraron m√∫ltiples docentes. Selecciona uno:</h3>
      <div id="listaResultados" style="display: grid; gap: 10px;"></div>
    </div>

    <!-- SECCI√ìN ENCONTRADA (oculta hasta que se busque) -->
    <div id="resultadoContainer" style="display: none;">
      
      <!-- ENCABEZADO CON CARGO Y NOMBRE -->
      <div class="encabezado">
        <div class="cargo" id="cargo">‚Äî</div>
        <div class="nombre-completo" id="nombreCompleto">‚Äî</div>
      </div>

      <!-- SECCI√ìN: INFORMACI√ìN PERSONAL -->
      <section class="seccion">
        <h2 class="titulo-seccion">üë§ Informaci√≥n Personal</h2>
        <div class="campos-doble">
          <div class="campo">
            <label class="etiqueta">Tipo de Identificaci√≥n</label>
            <div class="valor" id="tipoId">‚Äî</div>
          </div>
          <div class="campo">
            <label class="etiqueta">N√∫mero de Identificaci√≥n</label>
            <div class="valor" id="numeroId">‚Äî</div>
          </div>
          <div class="campo">
            <label class="etiqueta">Lugar de Expedici√≥n</label>
            <div class="valor" id="lugarExp">‚Äî</div>
          </div>
          <div class="campo">
            <label class="etiqueta">Fecha de Expedici√≥n</label>
            <div class="valor" id="fechaExp">‚Äî</div>
          </div>
          <div class="campo">
            <label class="etiqueta">Primer Nombre</label>
            <div class="valor" id="nombre1">‚Äî</div>
          </div>
          <div class="campo">
            <label class="etiqueta">Segundo Nombre</label>
            <div class="valor" id="nombre2">‚Äî</div>
          </div>
          <div class="campo">
            <label class="etiqueta">Primer Apellido</label>
            <div class="valor" id="apellido1">‚Äî</div>
          </div>
          <div class="campo">
            <label class="etiqueta">Segundo Apellido</label>
            <div class="valor" id="apellido2">‚Äî</div>
          </div>
          <div class="campo">
            <label class="etiqueta">Fecha de Nacimiento</label>
            <div class="valor" id="fechaNac">‚Äî</div>
          </div>
          <div class="campo">
            <label class="etiqueta">Edad</label>
            <div class="valor" id="edad">‚Äî</div>
          </div>
          <div class="campo">
            <label class="etiqueta">N√∫mero de Contacto</label>
            <div class="valor" id="contacto">‚Äî</div>
          </div>
          <div class="campo">
            <label class="etiqueta">Tipo de Sangre (RH)</label>
            <div class="valor" id="rh">‚Äî</div>
          </div>
          <div class="campo">
            <label class="etiqueta">G√©nero</label>
            <div class="valor" id="genero">‚Äî</div>
          </div>
        </div>
      </section>

      <!-- SECCI√ìN: INFORMACI√ìN LABORAL -->
      <section class="seccion">
        <h2 class="titulo-seccion">üíº Informaci√≥n Laboral</h2>
        <div class="campos-doble">
          <div class="campo">
            <label class="etiqueta">Departamento</label>
            <div class="valor" id="departamento">‚Äî</div>
          </div>
          <div class="campo">
            <label class="etiqueta">Estado</label>
            <div class="valor" id="estado">‚Äî</div>
          </div>
          <div class="campo">
            <label class="etiqueta">Dedicaci√≥n</label>
            <div class="valor" id="dedicacion">‚Äî</div>
          </div>
          <div class="campo">
            <label class="etiqueta">Estatus</label>
            <div class="valor" id="estatus">‚Äî</div>
          </div>
          <div class="campo">
            <label class="etiqueta">Fecha de la Novedad</label>
            <div class="valor" id="fechaNovedad">‚Äî</div>
          </div>
          <div class="campo">
            <label class="etiqueta">Correo Institucional</label>
            <div class="valor" id="correoIns">‚Äî</div>
          </div>
          <div class="campo">
            <label class="etiqueta">Correo Personal</label>
            <div class="valor" id="correoPersonal">‚Äî</div>
          </div>
        </div>
      </section>

      <!-- SECCI√ìN: FORMACI√ìN ACAD√âMICA -->
      <section class="seccion">
        <h2 class="titulo-seccion">üéì Formaci√≥n Acad√©mica</h2>
        <div class="campos-doble">
          <div class="campo">
            <label class="etiqueta">M√°ximo Nivel de Formaci√≥n</label>
            <div class="valor" id="nivelFormacion">‚Äî</div>
          </div>
          <div class="campo">
            <label class="etiqueta">√Årea de Conocimiento</label>
            <div class="valor" id="areaConocimiento">‚Äî</div>
          </div>
          <div class="campo">
            <label class="etiqueta">T√≠tulo Obtenido</label>
            <div class="valor" id="titulo">‚Äî</div>
          </div>
          <div class="campo">
            <label class="etiqueta">Instituci√≥n</label>
            <div class="valor" id="institucion">‚Äî</div>
          </div>
          <div class="campo">
            <label class="etiqueta">Pa√≠s</label>
            <div class="valor" id="pais">‚Äî</div>
          </div>
        </div>
      </section>

    </div>

  </div>

  <footer>
    <div class="logo-text">Universidad Aut√≥noma de Manizales</div>
    <p>&copy; 2026 UAM. Todos los derechos reservados.</p>
    <p>Sistema de Informaci√≥n de Docentes</p>
  </footer>

  <script>
    //const API_URL = "https://script.google.com/macros/s/AKfycbzcxg1TmzSoTZ94hAVpF522LHTd_3Mf28W4oMM6qXAKqptwlGthC53R_v2-f5Togxpa/exec";
    const API_URL = "https://script.google.com/macros/s/AKfycbzqoc3BdJEjP1NrQ_LqDzlcQZ5VUntixoBSABhpKQe43c8oYxIxwNJ-qWN5kEzFwVgC/exec";
    let allDocentes = [];

    // Elementos del DOM
      // Funci√≥n para formatear fechas ISO a yyyy/mm/dd
      function formatearFecha(fechaISO) {
        if (!fechaISO) return "‚Äî";
        try {
          const fecha = new Date(fechaISO);
          const year = fecha.getFullYear();
          const mes = String(fecha.getMonth() + 1).padStart(2, '0');
          const dia = String(fecha.getDate()).padStart(2, '0');
          return `${year}/${mes}/${dia}`;
        } catch (e) {
          return fechaISO; // Si no se puede parsear, devuelve el valor original
        }
      }

    const inputBusqueda = document.getElementById("busqueda");
    const btnBuscar = document.getElementById("btnBuscar");
    const btnLimpiar = document.getElementById("btnLimpiar");
    const divResultadoContainer = document.getElementById("resultadoContainer");
    const divResultadosMultiplesContainer = document.getElementById("resultadosMultiplesContainer");
    const divListaResultados = document.getElementById("listaResultados");
    const divError = document.getElementById("error");
    const divCargando = document.getElementById("cargando");

//    // Cargar datos al iniciar
//    async function cargarDatos() {
//      divCargando.style.display = "block";
//      divError.style.display = "none";
//      try {
//        const response = await fetch(API_URL);
//        if (!response.ok) throw new Error("Error al conectar con la API");
//        allDocentes = await response.json();
//        divCargando.style.display = "none";
//      } catch (err) {
//        divCargando.style.display = "none";
//        mostrarError("No se pudieron cargar los datos: " + err.message);
//      }
//    }

    // Cargar datos al iniciar
    async function cargarDatos() {
        divCargando.style.display = "block";
        divError.style.display = "none";

        try {
            const response = await fetch(API_URL);
            if (!response.ok) throw new Error("Error al conectar con la API");

            const data = await response.json();

            // üîê PASO 6: validar autorizaci√≥n
            if (data.error) {
            throw new Error("No tienes permisos para ver esta informaci√≥n");
            }

            allDocentes = data; // ‚Üê solo si est√° autorizado
            divCargando.style.display = "none";

            // aqu√≠ ya puedes llamar a renderTabla() o lo que uses
            renderTabla(allDocentes);

        } catch (err) {
            divCargando.style.display = "none";
            mostrarError("No se pudieron cargar los datos: " + err.message);
        }
    }

    // Buscar docente
    function buscarDocente() {
      const termino = inputBusqueda.value.trim().toLowerCase();
      
      if (!termino) {
        divError.style.display = "none";
        divResultadoContainer.style.display = "none";
        divResultadosMultiplesContainer.style.display = "none";
        return;
      }

      const resultados = allDocentes.filter(doc => {
        const nombre = (doc["Nombre Completo"] || "").toLowerCase();
        const numId = (doc["N√∫mero de Identificaci√≥n"] || "").toString().toLowerCase();
        const departamento = (doc["Departamento"] || "").toLowerCase();
        const nombre1 = (doc["Primer Nombre"] || "").toLowerCase();
        const apellido1 = (doc["Primer Apellido"] || "").toLowerCase();
        
        return nombre.includes(termino) || 
               numId.includes(termino) || 
               departamento.includes(termino) ||
               nombre1.includes(termino) ||
               apellido1.includes(termino);
      });

      if (resultados.length === 0) {
        mostrarError("‚ùå No se encontr√≥ ning√∫n docente con ese criterio");
        divResultadoContainer.style.display = "none";
        divResultadosMultiplesContainer.style.display = "none";
        return;
      }

      // Si hay UN SOLO resultado
      if (resultados.length === 1) {
        divResultadosMultiplesContainer.style.display = "none";
        mostrarDocente(resultados[0]);
        divError.style.display = "none";
        divResultadoContainer.style.display = "block";
        return;
      }

      // Si hay M√öLTIPLES resultados - mostrar lista
      mostrarListaResultados(resultados);
      divError.style.display = "none";
      divResultadoContainer.style.display = "none";
    }

    // Mostrar lista de docentes para seleccionar
    function mostrarListaResultados(resultados) {
      divListaResultados.innerHTML = "";
      
      resultados.forEach((doc, index) => {
        const item = document.createElement("div");
        item.style.cssText = `
          background: white;
          border: 2px solid #0069A3;
          border-radius: 6px;
          padding: 15px;
          cursor: pointer;
          transition: all 0.3s;
          display: flex;
          justify-content: space-between;
          align-items: center;
        `;
        
        item.innerHTML = `
          <div>
            <div style="font-weight: bold; color: #0069A3; font-size: 14px;">${doc["Nombre Completo"] || "‚Äî"}</div>
            <div style="color: #666; font-size: 12px;">ID: ${doc["N√∫mero de Identificaci√≥n"] || "‚Äî"} | ${doc["Departamento"] || "‚Äî"}</div>
            <div style="color: #999; font-size: 11px;">${doc["Cargo"] || "‚Äî"}</div>
          </div>
          <button style="
            background: #0069A3;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
          ">Ver</button>
        `;
        
        item.addEventListener("mouseenter", () => {
          item.style.background = "#e3f2fd";
          item.style.borderColor = "#F4D73B";
          item.style.boxShadow = "0 4px 8px rgba(0, 0, 0, 0.15)";
        });
        
        item.addEventListener("mouseleave", () => {
          item.style.background = "white";
          item.style.borderColor = "#0069A3";
          item.style.boxShadow = "none";
        });
        
        item.addEventListener("click", () => {
          mostraDocenteYOcultarLista(doc);
        });
        
        divListaResultados.appendChild(item);
      });

      divResultadosMultiplesContainer.style.display = "block";
    }

    // Mostrar docente seleccionado de la lista
    function mostraDocenteYOcultarLista(doc) {
      mostrarDocente(doc);
      divResultadosMultiplesContainer.style.display = "none";
      divResultadoContainer.style.display = "block";
      window.scrollTo(0, 0); // Scroll al inicio
    }

    function mostrarDocente(doc) {
      // Encabezado
      document.getElementById("cargo").textContent = doc["Cargo"] || "‚Äî";
      document.getElementById("nombreCompleto").textContent = doc["Nombre Completo"] || "‚Äî";

      // Informaci√≥n Personal
      document.getElementById("tipoId").textContent = doc["Tipo de Identificaci√≥n"] || "‚Äî";
      document.getElementById("numeroId").textContent = doc["N√∫mero de Identificaci√≥n"] || "‚Äî";
      document.getElementById("lugarExp").textContent = doc["Lugar de Expedici√≥n"] || "‚Äî";
        document.getElementById("fechaExp").textContent = formatearFecha(doc["Fecha de Expedici√≥n"]);
      document.getElementById("nombre1").textContent = doc["Primer Nombre"] || "‚Äî";
      document.getElementById("nombre2").textContent = doc["Segundo Nombre"] || "‚Äî";
      document.getElementById("apellido1").textContent = doc["Primer Apellido"] || "‚Äî";
      document.getElementById("apellido2").textContent = doc["Segundo Apellido"] || "‚Äî";
        document.getElementById("fechaNac").textContent = formatearFecha(doc["Fecha de Nacimiento"]);
      document.getElementById("edad").textContent = doc["Edad"] || "‚Äî";
      document.getElementById("contacto").textContent = doc["N√∫mero de Contacto"] || "‚Äî";
      document.getElementById("rh").textContent = doc["RH"] || "‚Äî";
      document.getElementById("genero").textContent = doc["Genero"] || "‚Äî";

      // Informaci√≥n Laboral
      document.getElementById("departamento").textContent = doc["Departamento"] || "‚Äî";
      document.getElementById("estado").textContent = doc["Estado"] || "‚Äî";
      document.getElementById("dedicacion").textContent = doc["Dedicaci√≥n"] || "‚Äî";
      document.getElementById("estatus").textContent = doc["Estatus"] || "‚Äî";
      document.getElementById("fechaNovedad").textContent = doc["Fecha de la Novedad"] || "‚Äî";
      document.getElementById("correoIns").textContent = doc["Correo Institucional"] || "‚Äî";
      document.getElementById("correoPersonal").textContent = doc["Correo Personal"] || "‚Äî";

      // Formaci√≥n Acad√©mica
      document.getElementById("nivelFormacion").textContent = doc["M√°ximo Nivel de Formaci√≥n"] || "‚Äî";
      document.getElementById("areaConocimiento").textContent = doc["√Årea de Conocimiento"] || "‚Äî";
      document.getElementById("titulo").textContent = doc["Titulo Obtenido"] || "‚Äî";
      document.getElementById("institucion").textContent = doc["Instituci√≥n"] || "‚Äî";
      document.getElementById("pais").textContent = doc["Pais"] || "‚Äî";
    }

    function mostrarError(mensaje) {
      divError.textContent = mensaje;
      divError.style.display = "block";
    }

    function limpiar() {
      inputBusqueda.value = "";
      divError.style.display = "none";
      divResultadoContainer.style.display = "none";
      divResultadosMultiplesContainer.style.display = "none";
      inputBusqueda.focus();
    }

    // Event listeners
    btnBuscar.addEventListener("click", buscarDocente);
    btnLimpiar.addEventListener("click", limpiar);
    inputBusqueda.addEventListener("keypress", (e) => {
      if (e.key === "Enter") buscarDocente();
    });

    // Cargar datos al abrir la p√°gina
    cargarDatos();
  </script>

</body>
</html>

